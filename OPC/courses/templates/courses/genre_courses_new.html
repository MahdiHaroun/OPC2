{% extends "core/base.html" %}
{% load static %}

{% block content %}
<style>
:root {
    --primary: #6366f1;
    --primary-light: #a5b4fc;
    --primary-dark: #3730a3;
    --success: #22c55e;
    --danger: #ef4444;
    --warning: #f59e0b;
    --bg: #f8fafc;
    --bg-dark: #18181b;
    --border: #e5e7eb;
    --border-dark: #232336;
    --card-bg: #ffffff;
    --card-bg-dark: #232336;
    --text: #1f2937;
    --text-light: #6b7280;
    --text-muted: #9ca3af;
    --text-dark: #f3f4f6;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.18), 0 1px 2px -1px rgb(0 0 0 / 0.18);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.18), 0 4px 6px -4px rgb(0 0 0 / 0.18);
    --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    --gradient-success: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
    --card-hover-dark: #282a36;
    --btn-hover-dark: #3b3e5a;
    --input-hover-dark: #23234a;
    --primary-hover-dark: #818cf8;
}
[data-theme="dark"] {
    --bg: #18181b;
    --card-bg: var(--card-bg-dark);
    --border: var(--border-dark);
    --text: var(--text-dark);
}

/* Dark theme card hover */
[data-theme="dark"] .card:hover,
[data-theme="dark"] .input-card:hover,
[data-theme="dark"] .results-card:hover {
    background: var(--card-hover-dark);
    box-shadow: 0 4px 24px 0 rgba(129,140,248,0.10);
    border-color: var(--primary-hover-dark);
}

/* Dark theme button hover */
[data-theme="dark"] .btn-primary:hover,
[data-theme="dark"] .btn-outline-primary:hover {
    background: var(--primary-hover-dark);
    color: #fff;
    border-color: var(--primary-hover-dark);
    box-shadow: 0 2px 12px 0 rgba(129,140,248,0.18);
}
[data-theme="dark"] .btn-secondary:hover {
    background: var(--btn-hover-dark);
    color: #fff;
}
[data-theme="dark"] .btn-success:hover {
    background: linear-gradient(135deg, #34d399 0%, #059669 100%);
    color: #fff;
}

/* Dark theme input hover/focus */
[data-theme="dark"] .form-control:focus,
[data-theme="dark"] .form-control:hover,
[data-theme="dark"] .course-search-input:focus,
[data-theme="dark"] .course-search-input:hover {
    border-color: var(--primary-hover-dark);
    background: var(--input-hover-dark);
    color: #fff;
    box-shadow: 0 0 0 2px var(--primary-hover-dark);
}
[data-theme="dark"] .form-control,
[data-theme="dark"] .course-search-input {
    background: var(--card-hover-dark);
    color: #fff;
    border-color: var(--border-dark);
}

/* Page Header */
.page-header {
    text-align: center;
    margin-bottom: 2rem;
    padding: 1.5rem 1rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 0 0 20px 20px;
}

.header-content {
    max-width: 800px;
    margin: 0 auto;
}

.page-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #ffffff;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
    margin-bottom: 0.75rem;
}

.page-subtitle {
    font-size: 1.2rem;
    color: rgba(255, 255, 255, 0.95);
    text-shadow: 1px 1px 4px rgba(0,0,0,0.2);
    margin: 0;
    line-height: 1.5;
}

/* Navigation Section */
.navigation-section {
    margin-bottom: 2rem;
    padding: 0 1rem;
}

.nav-container {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: center;
}

.nav-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.nav-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    color: white;
    text-decoration: none;
}

.nav-button i {
    font-size: 1.1rem;
}

/* Container */
.courses-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem 2rem 2rem;
    background: none; /* Remove background to eliminate black box */
    min-height: 100vh;
}
[data-theme="dark"] .courses-container {
    background: none; /* Remove background in dark mode as well */
}

/* Cards */
.card {
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(102, 126, 234, 0.1);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(102, 126, 234, 0.15);
    backdrop-filter: blur(20px);
    margin-bottom: 2rem;
    overflow: hidden;
    transition: all 0.4s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 60px rgba(102, 126, 234, 0.25);
    border-color: rgba(102, 126, 234, 0.3);
}

[data-theme="dark"] .card {
    background: rgba(45, 55, 72, 0.95);
    border-color: rgba(102, 126, 234, 0.2);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
}

/* Card Headers */
.card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem 2rem;
    border-bottom: none;
    margin: 0;
}

.card-header h3 {
    margin: 0;
    font-size: 1.4rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.card-body {
    padding: 1.5rem; /* Reduced padding */
}

/* Button Group */
.button-group {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
}

/* Recommend Button */
.btn-recommend {
    flex: 1;
    padding: 0.875rem 1.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 10px;
    color: white;
    font-size: 1rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.btn-recommend:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    background: linear-gradient(135deg, #5a67d8 0%, #667eea 100%);
}

/* Regenerate Button */
.btn-regenerate {
    padding: 0.875rem 1.25rem;
    background: #718096;
    border: none;
    border-radius: 10px;
    color: white;
    font-size: 0.95rem;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(113, 128, 150, 0.3);
}

.btn-regenerate:hover {
    transform: translateY(-2px);
    background: #4a5568;
    box-shadow: 0 4px 12px rgba(113, 128, 150, 0.4);
}

/* Loading Section */
.loading-card {
    text-align: center;
    padding: 3rem 2rem;
}

.loading-spinner {
    margin: 2rem auto;
    position: relative;
    width: 80px;
    height: 80px;
}

.spinner-ring {
    display: inline-block;
    width: 80px;
    height: 80px;
    border: 4px solid transparent;
    border-top: 4px solid #6a11cb;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-title {
    color: var(--text-primary);
    margin: 1rem 0 0.5rem;
    font-size: 1.5rem;
    font-weight: 600;
}

.loading-text {
    color: var(--text-secondary);
    font-size: 1rem;
    margin: 0;
}

/* Results Section */
.results-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 1rem;
}

.results-title h3 {
    margin: 0 0 1rem;
}

.results-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.recommendation-info {
    background: rgba(106, 17, 203, 0.1);
    border: 1px solid rgba(106, 17, 203, 0.2);
    border-radius: 10px;
    padding: 1rem;
    color: var(--text-primary);
    font-size: 0.95rem;
    line-height: 1.6;
    margin-top: 0.5rem;
}

/* Recommendations Grid */
.recommendations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Reduced min width */
    gap: 1.5rem; /* Reduced gap */
    margin-top: 1.5rem; /* Reduced margin */
    padding: 0.5rem 0; /* Reduced padding */
}

/* Course Cards */
.course-card {
    background: #ffffff;
    border: 2px solid #e2e8f0;
    border-radius: 16px;
    padding: 1.25rem;
    position: relative;
    transition: all 0.3s ease;
    cursor: pointer;
    overflow: hidden;
    margin-bottom: 0.5rem;
}

.course-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.course-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(102, 126, 234, 0.2);
    border-color: #667eea;
}

.course-card:hover::before {
    transform: scaleX(1);
}

.course-card.selected {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
}

.course-card.selected::before {
    transform: scaleX(1);
}

[data-theme="dark"] .course-card {
    background: #2d3748;
    border-color: #4a5568;
}
[data-theme="dark"] .course-card, [data-theme="dark"] .course-card * {
    color: #fff !important;
}

[data-theme="dark"] .course-card.selected {
    background: rgba(102, 126, 234, 0.15);
}

.course-title {
    color: #2d3748;
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    margin-right: 2.5rem;
    line-height: 1.4;
}

/* Input Source */
.input-source {
    color: #718096;
    font-size: 0.8rem;
    font-style: italic;
    margin-top: 0.75rem;
    padding: 0.4rem 0.75rem;
    background: rgba(102, 126, 234, 0.1);
    border-radius: 6px;
    border-left: 3px solid #667eea;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* No Results Message */
.no-results {
    text-align: center;
    padding: 3rem 2rem;
    color: var(--text-secondary);
    grid-column: 1 / -1; /* Span across all columns */
}

.no-results i {
    font-size: 3rem;
    color: var(--text-secondary);
    margin-bottom: 1rem;
    opacity: 0.6;
}

.no-results h4 {
    color: var(--text-primary);
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.no-results p {
    font-size: 1rem;
    opacity: 0.8;
    line-height: 1.6;
}

/* Buttons */
.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
}

.btn-outline-primary {
    background: transparent;
    color: #667eea;
    border-color: #667eea;
}

.btn-outline-primary:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
}

.btn-success {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    color: white;
    border: none;
    box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
}

.btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
    background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
}

.btn-outline-danger {
    background: transparent;
    color: #e53e3e;
    border-color: #e53e3e;
}

.btn-outline-danger:hover {
    background: #e53e3e;
    color: white;
    transform: translateY(-2px);
}

/* Error Section */
.error-card {
    text-align: center;
    padding: 3rem 2rem;
}

.error-content {
    max-width: 500px;
    margin: 0 auto;
}

.error-icon {
    font-size: 4rem;
    color: #dc3545;
    margin-bottom: 1.5rem;
}

.error-title {
    color: var(--text-primary);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.error-message {
    color: var(--text-secondary);
    font-size: 1rem;
    margin-bottom: 2rem;
    line-height: 1.6;
}

/* Responsive Design */
@media (max-width: 992px) {
    .courses-container {
        padding: 0 1.5rem 2rem 1.5rem; /* Reduced padding */
    }
    
    .recommendations-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    
    .results-header {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem; /* Reduced gap */
    }
    
    .results-actions {
        justify-content: center;
        gap: 1rem;
    }
    
    .card-header {
        padding: 1.25rem 1.5rem; /* Reduced padding */
    }
    
    .card-body {
        padding: 1.5rem; /* Reduced padding */
    }
}

@media (max-width: 768px) {
    .courses-container {
        padding: 0 1rem 2rem 1rem; /* Reduced padding */
    }
    
    .page-title {
        font-size: 2.5rem;
    }
    
    .page-subtitle {
        font-size: 1.1rem;
    }
    
    .card-body {
        padding: 1.25rem; /* Reduced padding */
    }
    
    .card-header {
        padding: 1rem 1.25rem; /* Reduced padding */
    }
    
    .recommendations-grid {
        grid-template-columns: 1fr;
        gap: 1.25rem; /* Reduced gap */
    }
    
    .course-card {
        padding: 1rem; /* Reduced padding */
    }
    
    .results-actions {
        flex-direction: column;
        gap: 0.75rem; /* Reduced gap */
    }
    
    .btn {
        width: 100%;
        justify-content: center;
        padding: 0.875rem 1.25rem; /* Reduced padding */
    }
}

@media (max-width: 480px) {
    .page-header {
        padding: 1rem 0.5rem;
    }
    
    .page-title {
        font-size: 2rem;
    }
    
    .card-body {
        padding: 1rem;
    }
    
    .card-header {
        padding: 1rem;
    }
    
    .course-card {
        padding: 0.875rem;
    }
}
</style>

<!-- Additional CSS for Genres Grid -->
<style>
.genres-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}
[data-theme="dark"] .genres-grid {
    background: transparent;
}

.genre-item {
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 1.2rem;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    min-height: 60px;
    display: flex;
    align-items: center;
    user-select: none;
}
[data-theme="dark"] .genre-item {
    background: #232336;
    border-color: #353657;
    color: var(--text-dark);
}

.genre-item:hover {
    background: rgba(102, 126, 234, 0.05);
    border-color: #667eea;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
}
[data-theme="dark"] .genre-item:hover,
[data-theme="dark"] .genre-item.selected,
[data-theme="dark"] .genre-item:has(.custom-control-input:checked) {
    background: #282a36;
    border-color: var(--primary-hover-dark);
    color: var(--text-dark);
    box-shadow: 0 4px 16px rgba(129,140,248,0.10);
}

.genre-item .custom-control {
    width: 100%;
    margin: 0;
    padding: 0;
    min-height: auto;
}

.genre-item .custom-control-input {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    z-index: 2;
    cursor: pointer;
    margin: 0;
}

.genre-item .custom-control-label {
    width: 100%;
    margin: 0;
    padding: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 500;
    font-size: 1rem;
    color: #2d3748;
    position: relative;
    padding-left: 2.5rem;
    pointer-events: none;
    z-index: 1;
}
[data-theme="dark"] .genre-item .custom-control-label {
    color: var(--text-dark);
}

.genre-item .custom-control-label::before {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    border: 2px solid #cbd5e0;
    border-radius: 4px;
    background: #ffffff;
    content: '';
    transition: all 0.3s ease;
}

.genre-item .custom-control-label::after {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    content: '';
    background: no-repeat 50%/50% 50%;
    transition: all 0.3s ease;
}

.genre-item .custom-control-input:checked ~ .custom-control-label {
    color: #667eea;
    font-weight: 600;
}
[data-theme="dark"] .genre-item .custom-control-input:checked ~ .custom-control-label {
    color: var(--primary-hover-dark);
}

.genre-item .custom-control-input:checked ~ .custom-control-label::before {
    background: #667eea;
    border-color: #667eea;
}

.genre-item .custom-control-input:checked ~ .custom-control-label::after {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3E%3Cpath fill='%23fff' d='m6.564.75-3.59 3.612-1.538-1.55L0 4.26 2.974 7.25 8 2.193z'/%3E%3C/svg%3E");
}

.genre-item:has(.custom-control-input:checked),
.genre-item.selected {
    background: rgba(102, 126, 234, 0.1);
    border-color: #667eea;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

/* Add active state for better feedback */
.genre-item:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
}

@media (max-width: 768px) {
    .genres-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 0.75rem;
    }
    
    .genre-item {
        padding: 0.75rem;
    }
    
    .custom-control-label {
        font-size: 0.9rem;
    }
}
</style>

<!-- Page Header -->
<div class="page-header">
    <div class="header-content">
        <h1 class="page-title">Genre-Based Course Recommendations</h1>
        <p class="page-subtitle">Discover amazing courses by selecting your favorite categories</p>
    </div>
</div>

<!-- Navigation Section -->
<div class="navigation-section">
    <div class="nav-container">
        <a href="{% url 'course_recommendation_page' %}" class="nav-button">
            <i class="fas fa-graduation-cap"></i>
            Try Course-Based Recommendations
        </a>
    </div>
</div>

<!-- Main Container -->
<div class="courses-container">
    <!-- Genre Selection Card -->
    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-tags"></i> Select Your Favorite Categories</h3>
            <p class="text-muted">Choose one or more categories to get personalized course recommendations</p>
        </div>
        <div class="card-body">
            <div id="genre-form">
                <!-- Genre Grid -->
                <div class="genres-grid">
                    <!-- Technology -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-technology" name="genres" value="Technology">
                            <label class="custom-control-label" for="genre-technology">
                                <i class="fas fa-laptop-code" style="color: #3498db;"></i>
                                Technology
                            </label>
                        </div>
                    </div>

                    <!-- Programming -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-programming" name="genres" value="Programming">
                            <label class="custom-control-label" for="genre-programming">
                                <i class="fas fa-code" style="color: #e74c3c;"></i>
                                Programming
                            </label>
                        </div>
                    </div>

                    <!-- Business -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-business" name="genres" value="Business">
                            <label class="custom-control-label" for="genre-business">
                                <i class="fas fa-briefcase" style="color: #f39c12;"></i>
                                Business
                            </label>
                        </div>
                    </div>

                    <!-- Design -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-design" name="genres" value="Design">
                            <label class="custom-control-label" for="genre-design">
                                <i class="fas fa-palette" style="color: #9b59b6;"></i>
                                Design
                            </label>
                        </div>
                    </div>

                    <!-- Marketing -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-marketing" name="genres" value="Marketing">
                            <label class="custom-control-label" for="genre-marketing">
                                <i class="fas fa-bullhorn" style="color: #e67e22;"></i>
                                Marketing
                            </label>
                        </div>
                    </div>

                    <!-- Data Science -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-data-science" name="genres" value="Data Science">
                            <label class="custom-control-label" for="genre-data-science">
                                <i class="fas fa-chart-bar" style="color: #2ecc71;"></i>
                                Data Science
                            </label>
                        </div>
                    </div>

                    <!-- Photography -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-photography" name="genres" value="Photography">
                            <label class="custom-control-label" for="genre-photography">
                                <i class="fas fa-camera" style="color: #34495e;"></i>
                                Photography
                            </label>
                        </div>
                    </div>

                    <!-- Music -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-music" name="genres" value="Music">
                            <label class="custom-control-label" for="genre-music">
                                <i class="fas fa-music" style="color: #e91e63;"></i>
                                Music
                            </label>
                        </div>
                    </div>

                    <!-- Health -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-health" name="genres" value="Health">
                            <label class="custom-control-label" for="genre-health">
                                <i class="fas fa-heartbeat" style="color: #e74c3c;"></i>
                                Health
                            </label>
                        </div>
                    </div>

                    <!-- Finance -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-finance" name="genres" value="Finance">
                            <label class="custom-control-label" for="genre-finance">
                                <i class="fas fa-dollar-sign" style="color: #27ae60;"></i>
                                Finance
                            </label>
                        </div>
                    </div>

                    <!-- Language -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-language" name="genres" value="Language">
                            <label class="custom-control-label" for="genre-language">
                                <i class="fas fa-language" style="color: #8e44ad;"></i>
                                Language
                            </label>
                        </div>
                    </div>

                    <!-- Art -->
                    <div class="genre-item">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="genre-art" name="genres" value="Art">
                            <label class="custom-control-label" for="genre-art">
                                <i class="fas fa-paint-brush" style="color: #f39c12;"></i>
                                Art
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button type="button" class="btn-recommend" id="get-recommendations">
                        <i class="fas fa-magic"></i> Get Recommendations
                    </button>
                    <button type="button" class="btn-regenerate" id="regenerate-recommendations" style="display: none;">
                        <i class="fas fa-redo-alt"></i> New Recommendations
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Section -->
    <div class="card loading-section" id="loading-section" style="display: none;">
        <div class="card-body loading-card">
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
            </div>
            <h4 class="loading-title">Finding Perfect Courses</h4>
            <p class="loading-text">Analyzing categories and selecting the best recommendations for you...</p>
        </div>
    </div>

    <!-- Results Section -->
    <div class="card results-section" id="results-section" style="display: none;">
        <div class="card-header">
            <div class="results-header">
                <div class="results-title">
                    <h3><i class="fas fa-graduation-cap"></i> Recommended Courses</h3>
                    <div class="recommendation-info" id="recommendation-info"></div>
                </div>
                <div class="results-actions">
                    <button type="button" class="btn-regenerate" id="regenerate-btn">
                        <i class="fas fa-redo-alt"></i> New Recommendations
                    </button>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="recommendations-grid" id="recommendations-grid">
                <!-- Recommendations will be populated here -->
            </div>
        </div>
    </div>

    <!-- Error Section -->
    <div class="card error-section" id="error-section" style="display: none;">
        <div class="card-body error-card">
            <div class="error-content">
                <i class="fas fa-exclamation-triangle error-icon"></i>
                <h4 class="error-title">Oops! Something went wrong</h4>
                <p class="error-message" id="error-message">We encountered an issue while getting your recommendations. Please try again.</p>
                <button type="button" class="btn btn-outline-primary" onclick="location.reload()">
                    <i class="fas fa-refresh"></i> Try Again
                </button>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for AJAX functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const getRecommendationsBtn = document.getElementById('get-recommendations');
    const regenerateBtn = document.getElementById('regenerate-btn');
    const regenerateRecommendationsBtn = document.getElementById('regenerate-recommendations');
    const loadingSection = document.getElementById('loading-section');
    const resultsSection = document.getElementById('results-section');
    const errorSection = document.getElementById('error-section');
    const recommendationsGrid = document.getElementById('recommendations-grid');
    const recommendationInfo = document.getElementById('recommendation-info');
    const errorMessage = document.getElementById('error-message');

    function getSelectedGenres() {
        const checkboxes = document.querySelectorAll('input[name="genres"]:checked');
        return Array.from(checkboxes).map(cb => cb.value);
    }

    function showLoading() {
        loadingSection.style.display = 'block';
        resultsSection.style.display = 'none';
        errorSection.style.display = 'none';
    }

    function hideLoading() {
        loadingSection.style.display = 'none';
    }

    function showError(message) {
        hideLoading();
        errorMessage.textContent = message;
        errorSection.style.display = 'block';
        resultsSection.style.display = 'none';
    }

    function showResults(data) {
        hideLoading();
        if (data.error) {
            showError(data.error);
            return;
        }

        const courses = data.recommendations || [];
        const selectedGenres = getSelectedGenres();
        
        recommendationInfo.innerHTML = `
            <i class="fas fa-info-circle"></i>
            Found <strong>${courses.length}</strong> great courses for categories: <strong>${selectedGenres.join(', ')}</strong>
        `;

        recommendationsGrid.innerHTML = '';

        if (courses.length === 0) {
            recommendationsGrid.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-graduation-cap"></i>
                    <h4>No Courses Found</h4>
                    <p>Try selecting different categories or fewer category combinations.</p>
                </div>
            `;
        } else {
            courses.forEach((course, index) => {
                const courseCard = document.createElement('div');
                courseCard.className = 'course-card';
                courseCard.innerHTML = `
                    <h5 class="course-title">${course}</h5>
                    <div class="input-source">
                        <i class="fas fa-tags"></i>
                        Genre-based recommendation
                    </div>
                `;
                recommendationsGrid.appendChild(courseCard);
            });
        }

        resultsSection.style.display = 'block';
        errorSection.style.display = 'none';
        
        // Show regenerate button
        regenerateRecommendationsBtn.style.display = 'inline-flex';
    }

    function getRecommendations() {
        const selectedGenres = getSelectedGenres();
        
        if (selectedGenres.length === 0) {
            alert('Please select at least one category to get recommendations.');
            return;
        }

        showLoading();

        // Make AJAX request to get genre-based recommendations
        fetch('/api/courses/recommend-genre/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({
                course_genres: selectedGenres,
                num_recommendations: 10,
                model_used: 'Genre-Based',
                save_history: false,
                regenerate: false
            })
        })
        .then(response => response.json())
        .then(data => {
            showResults(data);
        })
        .catch(error => {
            console.error('Error:', error);
            showError('Failed to get recommendations. Please try again.');
        });
    }

    // Event listeners
    getRecommendationsBtn.addEventListener('click', getRecommendations);
    regenerateBtn.addEventListener('click', getRecommendations);
    regenerateRecommendationsBtn.addEventListener('click', getRecommendations);

    // Add click handlers for genre items
    document.querySelectorAll('.genre-item').forEach(item => {
        item.addEventListener('click', function(e) {
            // Prevent double-triggering if clicked directly on checkbox or label
            if (e.target.type === 'checkbox') {
                return; // Let the checkbox handle it naturally
            }
            
            const checkbox = this.querySelector('input[type="checkbox"]');
            if (checkbox) {
                checkbox.checked = !checkbox.checked;
                
                // Trigger change event for any listeners
                const changeEvent = new Event('change', { bubbles: true });
                checkbox.dispatchEvent(changeEvent);
                
                // Update visual state immediately
                if (checkbox.checked) {
                    this.classList.add('selected');
                } else {
                    this.classList.remove('selected');
                }
            }
        });
        
        // Also handle checkbox change events directly
        const checkbox = item.querySelector('input[type="checkbox"]');
        if (checkbox) {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }
    });
});
</script>

<!-- CSRF Token -->
{% csrf_token %}

{% endblock %}
